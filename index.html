<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CrimGamble — Opportunity Theory Simulation</title>
  <meta name="description" content="Interactive simulation illustrating Opportunity Theory with flashy casino-style animations for wins and losses."/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    :root{--bg:#030309;--card:#0b0b10;--muted:#94a3b8;--neon-pink:#ff3ca6;--neon-cyan:#00f0ff;--neon-green:#22ff7a;--neon-yellow:#ffd24a}
    body{background:linear-gradient(180deg,#02020a 0%, #070712 70%); color:#e6eef8; font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial; overflow-x:hidden}
    .neon{filter:drop-shadow(0 0 6px rgba(255,56,166,.25))}
    header{border-bottom:1px solid rgba(255,255,255,0.04)}
    .glow{box-shadow:0 0 10px rgba(255,56,166,.18),0 0 30px rgba(0,240,255,.06)}
    .pill{background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); padding:6px 10px; border-radius:999px}
    .reel{width:120px;height:120px;border-radius:12px;background:linear-gradient(180deg,#0c0c12, #171722);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:22px}
    .btn-main{background:linear-gradient(90deg,var(--neon-pink),var(--neon-cyan));color:#050607;padding:.75rem 1.25rem;border-radius:12px;font-weight:700}
    .btn-ghost{border:1px solid rgba(255,255,255,0.06);padding:.6rem .9rem;border-radius:10px}
    .card{perspective:1000px}
    .card-inner{transition:transform .6s;transform-style:preserve-3d}
    .card:hover .card-inner{transform:rotateY(180deg)}
    .card-front,.card-back{backface-visibility:hidden;position:relative}
    .card-back{transform:rotateY(180deg)}
    footer{border-top:1px solid rgba(255,255,255,0.03);margin-top:36px}
    .credit-display{position:fixed;top:20px;right:20px;background:rgba(0,0,0,0.5);padding:12px 20px;border-radius:20px;font-weight:700;z-index:1000;pointer-events:none;}
    .credit-up{animation:popUp 0.7s forwards;color:#22ff7a;}
    .credit-down{animation:popUp 0.7s forwards;color:#ff3ca6;}
    @keyframes popUp{0%{transform:scale(1);opacity:1}50%{transform:scale(1.5);opacity:1}100%{transform:scale(1);opacity:0}}
    @media (max-width:700px){.reel{width:90px;height:90px;font-size:18px}}
  </style>
</head>
<body>
  <div id="creditDisplay" class="credit-display">Credits: 100</div>
  <header class="px-6 py-4 flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-extrabold" style="color:var(--neon-cyan)">CrimGamble <span style="color:var(--neon-pink);font-weight:600">— Opportunity Theory Lab</span></h1>
      <p class="text-sm text-muted" style="color:var(--muted)">Simulation shows how <strong>motivation</strong> and <strong>opportunity</strong> influence choices, with flashy animations for wins and losses.</p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-6 py-8">

    <!-- Main Game Section -->
    <section class="grid md:grid-cols-2 gap-6 items-start">
      <div class="bg-[#070712] p-6 rounded-xl shadow-lg">
        <h2 class="text-xl font-bold" style="color:var(--neon-pink)">Motivation vs Opportunity</h2>
        <p class="text-sm mt-2" style="color:var(--muted)">Decide to play honestly or cheat for higher rewards.</p>

        <div class="mt-6 grid grid-cols-3 gap-3 justify-between items-center">
          <div class="reel" id="reel1">—</div>
          <div class="reel" id="reel2">—</div>
          <div class="reel" id="reel3">—</div>
        </div>

        <div class="mt-6 flex gap-3">
          <button id="playBtn" class="btn-main glow">Play Honest</button>
          <button id="cheatBtn" class="btn-main" style="background:linear-gradient(90deg,var(--neon-green),var(--neon-yellow));">Attempt Cheat</button>
          <button id="resetBtn" class="btn-ghost">Reset Stats</button>
        </div>
      </div>

      <!-- Controls Section -->
      <aside class="bg-[#070712] p-6 rounded-xl shadow-lg">
        <h3 class="text-lg font-semibold" style="color:var(--neon-cyan)">Controls</h3>
        <div class="mt-3">
          <label class="block text-sm text-muted">Motivation Level (Cheat Risk)</label>
          <input id="riskRange" type="range" min="0" max="100" value="40" class="w-full mt-2" />
        </div>
        <div class="mt-4">
          <label class="block text-sm text-muted">Opportunity Level (Guard Presence)</label>
          <select id="guardSel" class="w-full mt-2 bg-transparent border border-white/5 rounded-md p-2">
            <option value="0">No guardians / high opportunity</option>
            <option value="0.4">Moderate guardians</option>
            <option value="0.8" selected>Strong guardians / low opportunity</option>
          </select>
        </div>
      </aside>
    </section>

    <!-- All-In Wager Section -->
    <section class="mt-8 bg-[#070712] p-6 rounded-xl shadow-lg">
      <h3 class="text-lg font-semibold" style="color:var(--neon-yellow)">All-In Wager</h3>
      <p class="text-sm text-muted mt-2">Risk all your current credits for a chance to double them or lose everything!</p>
      <div class="mt-4 flex gap-3">
        <button id="allInBtn" class="btn-main glow" style="background:linear-gradient(90deg,var(--neon-yellow),var(--neon-green));">WAGER ALL CREDITS</button>
      </div>
    </section>

  </main>

  <script>
    let credits = 100;
    const creditDisplay = document.getElementById('creditDisplay');
    const state={rounds:0,cheats:0,detections:0,totalPayout:0};
    const reels=[document.getElementById('reel1'),document.getElementById('reel2'),document.getElementById('reel3')];
    const roundsEl=document.getElementById('rounds');
    const cheatsEl=document.getElementById('cheats');
    const detectionsEl=document.getElementById('detections');
    const avgPayoutEl=document.getElementById('avgPayout');
    const playBtn=document.getElementById('playBtn');
    const cheatBtn=document.getElementById('cheatBtn');
    const resetBtn=document.getElementById('resetBtn');
    const allInBtn=document.getElementById('allInBtn');
    const riskRange=document.getElementById('riskRange');
    const guardSel=document.getElementById('guardSel');

    function randomSymbol(){const syms=['★','♠','◆','♥','7'];return syms[Math.floor(Math.random()*syms.length)];}
    function spinReels(){for(let i=0;i<3;i++){reels[i].textContent=randomSymbol();}}

    function triggerCoins(){
      const duration=1500;
      const animationEnd=Date.now()+duration;
      const defaults={startVelocity:40,spread:360,ticks:60,zIndex:1000,shapes:['circle'],colors:['#FFD700','#FFAA00','#FFFF00']};
      const interval=setInterval(()=>{
        const timeLeft=animationEnd-Date.now();
        if(timeLeft<=0) return clearInterval(interval);
        const particleCount=8+Math.random()*12;
        confetti(Object.assign({},defaults,{particleCount,origin:{x:Math.random(),y:Math.random()*0.2}}));
      },50);
    }

    function showCreditChange(amount){
      const span = document.createElement('span');
      span.textContent = (amount>0?`+${amount}`:`${amount}`);
      span.className = `credit-display ${amount>0?'credit-up':'credit-down'}`;
      document.body.appendChild(span);
      span.style.top = '50px';
      span.style.right = '50px';
      setTimeout(()=>{span.remove();},700);
    }

    function updateCreditDisplay(){
      creditDisplay.textContent = `Credits: ${credits}`;
    }

    allInBtn.addEventListener('click',()=>{
      if(credits<=0) return alert('No credits to wager!');
      spinReels();
      setTimeout(()=>{
        const win = Math.random()<0.5;
        const change = win ? credits : -credits;
        credits += change;
        triggerCoins();
        showCreditChange(change);
        updateCreditDisplay();
      }, 800);
    });

    updateCreditDisplay();
  </script>
</body>
</html>
